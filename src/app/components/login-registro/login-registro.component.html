<section class="registro-container min-h-screen flex flex-col justify-center items-center bg-[#f0f9ff]">

  <!-- Capa central con 3 pisos -->
  <div class="w-full max-w-7xl flex flex-col items-center relative">

    <!-- Contenido principal: solo el formulario, mismo estilo que registro -->
    <div class="registro-card">
      <div class="registro-header">
        <div class="logo-container">
          <img src="assets/images/login-logo.png"
            alt="Logo del Sistema Educativo"
            class="logo-icon"
            loading="lazy"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';">
            <i class="fas fa-graduation-cap logo-icon"
              aria-hidden="true"
            style="display: none;"></i>
          </div>
          <h1 class="registro-title">Crear nueva cuenta</h1>
          <p class="registro-subtitle">Regístrate en la Plataforma LMS ERK</p>
        </div>


        <!-- Formumario de Registro -->
        <form (ngSubmit)="onSubmit()" [formGroup]="registroForm">
          <!-- Selección de perfil en la misma línea -->
          <div class="flex gap-4">
            <div class="form-group w-full">
              <label for="id_perfil" class="form-label">Perfil:</label>
              <select
                id="id_perfil"
                formControlName="id_perfil"
                class="form-input"
                [class.error]="getFieldError('id_perfil')"
                >
                <option value="2">Estudiante</option>
                <option value="3">Docente</option>
              </select>
              @if (getFieldError('id_perfil')) {
                <p class="error-message">
                  {{ getFieldError('id_perfil') }}
                </p>
              }
            </div>
          </div>
          <!-- Campos dinámicos según perfil -->
          @if (registroForm.get('id_perfil')?.value === '2') {
            <div class="form-group">
              <label for="nrodni" class="form-label">Nro DNI:</label>
              <input
                id="nrodni"
                formControlName="nrodni"
                type="text"
                placeholder="Número de DNI"
                class="form-input"
                [class.error]="getFieldError('nrodni')"
                />
                @if (getFieldError('nrodni')) {
                  <p class="error-message">
                    {{ getFieldError('nrodni') }}
                  </p>
                }
              </div>
              <div class="form-group">
                <label for="correo" class="form-label">Correo Electrónico:</label>
                <input
                  id="correo"
                  formControlName="correo"
                  type="email"
                  placeholder="Ingresa tu correo"
                  class="form-input"
                  [class.error]="getFieldError('correo')"
                  />
                  @if (getFieldError('correo')) {
                    <p class="error-message">
                      {{ getFieldError('correo') }}
                    </p>
                  }
                </div>
              } @else {
                <div class="form-group">
                  <label for="correo" class="form-label">Correo Electrónico:</label>
                  <input
                    id="correo"
                    formControlName="correo"
                    type="email"
                    placeholder="Ingresa tu correo"
                    class="form-input"
                    [class.error]="getFieldError('correo')"
                    />
                    @if (getFieldError('correo')) {
                      <p class="error-message">
                        {{ getFieldError('correo') }}
                      </p>
                    }
                  </div>
                  <div class="form-group">
                    <label for="nrodni" class="form-label">Nro DNI:</label>
                    <input
                      id="nrodni"
                      formControlName="nrodni"
                      type="text"
                      placeholder="Número de DNI"
                      class="form-input"
                      [class.error]="getFieldError('nrodni')"
                      />
                      @if (getFieldError('nrodni')) {
                        <p class="error-message">
                          {{ getFieldError('nrodni') }}
                        </p>
                      }
                    </div>
                  }
                  <!-- <h2>Crear una cuenta</h2> -->

                  <!-- Nombres y Apellidos en la misma línea -->
                  <div class="flex gap-4">
                    <div class="form-group w-1/2">
                      <label for="nombres" class="form-label">Nombres:</label>
                      <input
                        id="nombres"
                        formControlName="nombres"
                        type="text"
                        placeholder="Ingresar Nombres"
                        class="form-input"
                        [class.error]="getFieldError('nombres')"
                        />
                        @if (getFieldError('nombres')) {
                          <p class="error-message">
                            {{ getFieldError('nombres') }}
                          </p>
                        }
                      </div>
                      <div class="form-group w-1/2">
                        <label for="apellidos" class="form-label">Apellidos:</label>
                        <input
                          id="apellidos"
                          formControlName="apellidos"
                          type="text"
                          placeholder="Ingresar Apellidos"
                          class="form-input"
                          [class.error]="getFieldError('apellidos')"
                          />
                          @if (getFieldError('apellidos')) {
                            <p class="error-message">
                              {{ getFieldError('apellidos') }}
                            </p>
                          }
                        </div>
                      </div>

                      <div class="form-group">
                        <label for="fecha_nacimiento" class="form-label">Fecha de Nacimiento:</label>
                        <input
                          id="fecha_nacimiento"
                          formControlName="fecha_nacimiento"
                          type="date"
                          placeholder="Fecha de nacimiento"
                          class="form-input"
                          [class.error]="getFieldError('fecha_nacimiento')"
                          />
                          @if (getFieldError('fecha_nacimiento')) {
                            <p class="error-message">
                              {{ getFieldError('fecha_nacimiento') }}
                            </p>
                          }
                        </div>
                        <div class="form-group">
                          <label for="id_colegio" class="form-label">Colegio:</label>
                          <select
                            id="id_colegio"
                            formControlName="id_colegio"
                            class="form-input"
                            [class.error]="getFieldError('id_colegio')"
                            >
                            <option value="" disabled selected>Seleccione un colegio</option>
                            @for (colegio of colegios; track colegio) {
                              <option [value]="colegio.id_colegio">
                                {{ colegio.nombre }}
                              </option>
                            }
                          </select>
                          @if (getFieldError('id_colegio')) {
                            <p class="error-message">
                              {{ getFieldError('id_colegio') }}
                            </p>
                          }
                        </div>

                        <!-- Contraseñas en la misma línea -->
                        <div class="flex gap-4">
                          <div class="form-group w-1/2">
                            <label for="password" class="form-label">Ingrese Contraseña:</label>
                            <input
                              id="password"
                              formControlName="password"
                              type="password"
                              placeholder="Crea una contraseña"
                              class="form-input"
                              [class.error]="getFieldError('password')"
                              />
                              @if (getFieldError('password')) {
                                <p class="error-message">
                                  {{ getFieldError('password') }}
                                </p>
                              }
                            </div>
                            <div class="form-group w-1/2">
                              <label for="password2" class="form-label">Repetir Contraseña:</label>
                              <input
                                id="password2"
                                formControlName="password2"
                                type="password"
                                placeholder="Confirma tu contraseña"
                                class="form-input"
                                [class.error]="getFieldError('password2')"
                                />
                                @if (getFieldError('password2')) {
                                  <p class="error-message">
                                    {{ getFieldError('password2') }}
                                  </p>
                                }
                              </div>
                            </div>

                            <!-- Botones Limpiar y Registrar, alineados horizontalmente -->
                            <div class="flex justify-center items-center gap-4 mt-4">
                              <button
                                type="button"
                                class="w-[30%] flex items-center justify-center text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5"
                                (click)="onReset()"
                                [disabled]="loading">
                                Limpiar
                              </button>
                              <button
                                type="submit"
                                class="w-[60%] flex items-center justify-center text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 disabled:opacity-50 disabled:cursor-not-allowed"
                                [disabled]="!canSubmit"
                                >
                                @if (loading) {
                                  <span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>
                                }
                                {{ loading ? 'Registrando...' : 'Registrar Usuario' }}
                              </button>
                            </div>

                            <!-- Mensaje de error general -->
                            @if (registroError) {
                              <div class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded">
                                {{ registroError }}
                              </div>
                            }

                          </form>

                        </div>

                        <!-- Panel flotante de navegación y textos -->
                        @if (showFloatingPanel) {
                          <div class="login-registro-floating-panel fixed bottom-8 right-8 bg-white/90 rounded-xl shadow-lg p-6 flex flex-col items-center gap-4 z-50">
                            <button (click)="showFloatingPanel=false" aria-label="Cerrar" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 text-xl font-bold focus:outline-none">&times;</button>
                            <h2 class="text-lg font-bold text-gray-700 mb-2">Accesos rápidos</h2>
                            <div class="flex w-full gap-4 mb-2">
                              <a routerLink="/opciones"
                                class="w-1/2 text-center inline-block px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition shadow">
                                Ir a Opciones
                              </a>
                              <a routerLink="/inicio"
                                class="w-1/2 text-center inline-block px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition shadow">
                                Ir a Inicio
                              </a>
                            </div>
                            <a routerLink="/login"
                              class="block text-center px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition shadow w-full">
                              Regresar al Login
                            </a>
                            <div class="mt-4 text-center">
                              <p class="footer-text text-xs text-gray-500">
                                <i class="fas fa-shield-alt" aria-hidden="true"></i>
                                Sistema de Gestión Educativa &copy; 2025
                              </p>
                              <p class="footer-subtitle text-xs text-gray-400">
                                Plataforma segura para la gestión educativa
                              </p>
                            </div>
                          </div>
                        }

                      </div>

                    </section>
