<div class="antialiased bg-gray-50 dark:bg-gray-900">
  <nav class="bg-verde-claro border-b border-gray-200 px-4 py-2.5 dark:bg-verde-claro dark:border-gray-700 fixed left-0 right-0 top-0 z-50">

    <div class="flex flex-wrap justify-between items-center">
      <div class="flex justify-start items-center">
        <button
          (click)="toggleSidebar()"
          aria-controls="drawer-navigation"
          class="p-2 mr-2 text-gray-600 rounded-lg cursor-pointer md:hidden hover:text-gray-900 hover:bg-gray-100 focus:bg-gray-100 dark:focus:bg-gray-700 focus:ring-2 focus:ring-gray-100 dark:focus:ring-gray-700 dark:text-gray-400 dark:hover:bg-[#76B177] dark:hover:text-white"
          >
          <svg
            aria-hidden="true"
            class="w-6 h-6"
            fill="currentColor"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
            >
            <path
              fill-rule="evenodd"
              d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
              clip-rule="evenodd"
            ></path>
          </svg>
          <svg
            aria-hidden="true"
            class="hidden w-6 h-6"
            fill="currentColor"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
            >
            <path
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"
            ></path>
          </svg>
          <span class="sr-only">Toggle sidebar</span>
        </button>
        <a href="/" class="flex items-center justify-between mr-4">
          <img
            src="assets/images/login-logo.png"
            class="mr-3 h-8"
            alt="Flowbite Logo"
            />
            <span class="self-center text-2xl font-extrabold whitespace-nowrap text-white drop-shadow-lg tracking-wide">LMS - Eureka ¬´ OPCIONES ¬ª</span>
          </a>

        </div>

        <!-- INICIA MENU ESP -->
        <div class="flex items-center lg:order-2">

          <!-- BOT√ìN TEMPORAL PARA DEBUG - MUY VISIBLE -->
          <!-- <button
          (click)="verificarLocalStorage()"
          class="mx-2 px-4 py-2 bg-yellow-500 text-black font-bold rounded-lg hover:bg-yellow-400 text-sm">
          üîç DEBUG LOCAL
        </button> -->

        <!-- <button
        (click)="probarLoginDirecto()"
        class="mx-2 px-4 py-2 bg-purple-500 text-white font-bold rounded-lg hover:bg-purple-400 text-sm">
        üß™ TEST LOGIN
      </button> -->

      <!-- <button
      (click)="decodificarToken()"
      class="mx-2 px-4 py-2 bg-orange-500 text-white font-bold rounded-lg hover:bg-orange-400 text-sm">
      üîê VER TOKEN
    </button> -->

    <button
      type="button"
      data-drawer-toggle="drawer-navigation"
      aria-controls="drawer-navigation"
      class="p-2 mr-1 text-gray-500 rounded-lg md:hidden hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-700 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600"
      >
      <span class="sr-only">Toggle search</span>
      <svg aria-hidden="true" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path clip-rule="evenodd" fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"></path>
      </svg>
    </button>

    <!-- Open user menu -->
    <button
      type="button"
      class="flex mx-3 text-sm bg-gray-800 rounded-full md:mr-0 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600"
      id="user-menu-button"
      aria-expanded="false"
      data-dropdown-toggle="dropdown"
      >
      <span class="sr-only">Open user menu</span>
      <img
        class="w-8 h-8 rounded-full"
        [src]="avatarUsuario"
        [alt]="nombreUsuario + ' photo'"
        />
      </button>

      <div
        class="hidden z-50 my-4 w-56 text-base list-none bg-white divide-y divide-gray-100 shadow dark:bg-gray-700 dark:divide-gray-600 rounded-xl"
        id="dropdown"
        >
        <div class="py-3 px-4 bg-gray-50 dark:bg-[#76B177]">
          <span
            class="block text-sm font-semibold text-gray-900 dark:text-white"
            >{{ nombreUsuario }}</span
            >
            <span
              class="block text-sm text-gray-900 truncate dark:text-white"
              >{{ rolUsuario }}</span
              >
            </div>
            <ul
              class="py-1 text-gray-700 dark:text-gray-300"
              aria-labelledby="dropdown"
              >
              <li>
                <a
                  href="#"
                  class="block py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-400 dark:hover:text-white"
                  >Mi Perfil</a
                  >
                </li>
                <li>
                  <a
                    href="#"
                    class="block py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-400 dark:hover:text-white"
                    >Configuraciones</a
                    >
                  </li>
                </ul>
                <ul
                  class="py-1 text-gray-700 dark:text-gray-300"
                  aria-labelledby="dropdown"
                  >
                  <li>
                    <button
                      (click)="cerrarSesion()"
                      (keyup.enter)="cerrarSesion()"
                      class="block w-full text-left py-2 px-4 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white cursor-pointer"
                      tabindex="0"
                      >Cerrar sesi√≥n</button
                      >
                    </li>
                  </ul>
                </div>

              </div>

            </div>
          </nav>

          <!-- Sidebar -->
          <aside
            class="fixed top-0 left-0 z-40 w-64 h-screen pt-14 transition-transform -translate-x-full bg-verde-claro border-r border-gray-200 md:translate-x-0 dark:bg-verde-claro dark:border-gray-700"
            aria-label="Sidenav"
            id="drawer-navigation"
            >
            <div class="overflow-y-auto py-5 px-3 h-full bg-white dark:bg-gray-800">
              <ul>

                <!-- Usuario autenticado actual -->
                <li class="px-3 py-2 mb-4 bg-gray-50 dark:bg-gray-700 rounded-lg border-l-4 border-green-500">
                  <div class="flex items-center space-x-3">
                    <!-- Avatar peque√±o -->
                    <div class="flex-shrink-0">
                      <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-xs font-bold">
                        {{ iniciales }}
                      </div>
                    </div>

                    <!-- Informaci√≥n del usuario -->
                    <div class="flex-1 min-w-0">
                      <div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">
                        <span [class]="statusColor">‚óè</span> {{ statusText }}
                      </div>
                      <div class="font-medium text-gray-900 dark:text-white text-sm truncate">
                        {{ nombreUsuario }}
                      </div>
                      <div class="text-xs text-gray-600 dark:text-gray-300">
                        {{ rolUsuario }}
                      </div>
                    </div>
                  </div>

                  <!-- Botones temporales para debug -->
                  <!-- <div class="mt-2 space-y-1">
                  <button
                    (click)="testSimple()"
                    class="w-full px-2 py-1 bg-pink-500 text-white text-xs rounded hover:bg-pink-600">
                    ‚úÖ TEST SIMPLE
                  </button>
                  <button
                    (click)="simularDatosUsuario()"
                    class="w-full px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">
                    üß™ Simular Usuario
                  </button>
                  <button
                    (click)="verificarLocalStorage()"
                    class="w-full px-2 py-1 bg-yellow-500 text-white text-xs rounded hover:bg-yellow-600">
                    üîç Ver LocalStorage
                  </button>
                  <button
                    (click)="decodificarToken()"
                    class="w-full px-2 py-1 bg-orange-500 text-white text-xs rounded hover:bg-orange-600">
                    üîê Ver Token
                  </button>
                  <button
                    (click)="limpiarDatos()"
                    class="w-full px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">
                    üßπ Limpiar Datos
                  </button>
                  <button
                    (click)="verificarEstadoPostLogin()"
                    class="w-full px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600">
                    üéØ Verificar Login
                  </button>
                  <button
                    (click)="cerrarSesionSilencioso()"
                    class="w-full px-2 py-1 bg-gray-500 text-white text-xs rounded hover:bg-gray-600">
                    üîá Cerrar Silencioso
                  </button>
                </div> -->
              </li>
              <!-- Fin de usuario autenticado -->

            </ul>

            <ul
              class="pt-2 mt-2 space-y-2 border-t border-gray-200 dark:border-gray-700"
              >

              <li>
                <a
                  href="/perfil-admin-pri"
                  class="flex items-center p-2 text-base font-medium text-gray-900 rounded-lg transition duration-75 hover:bg-gray-100 dark:hover:bg-[#76B177] dark:text-white group"
                  >
                  <svg
                    aria-hidden="true"
                    class="flex-shrink-0 w-6 h-6 text-gray-500 transition duration-75 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                    >
                    <!-- <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path> -->
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v4a1 1 0 001 1h3v6a1 1 0 001 1h8a1 1 0 001-1v-6h3a1 1 0 001-1V7a1 1 0 00-1-1H4a1 1 0 00-1 1z" />
                  </svg>
                  <span class="ml-3">Admin Pri</span>
                </a>
              </li>
              <li>
                <a
                  href="perfil-admin-sec"
                  class="flex items-center p-2 text-base font-medium text-gray-900 rounded-lg transition duration-75 hover:bg-gray-100 dark:hover:bg-[#76B177] dark:text-white group"
                  >
                  <svg
                    aria-hidden="true"
                    class="flex-shrink-0 w-6 h-6 text-gray-500 transition duration-75 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                    >
                    <!-- <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"></path> -->
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v4a1 1 0 001 1h3v6a1 1 0 001 1h8a1 1 0 001-1v-6h3a1 1 0 001-1V7a1 1 0 00-1-1H4a1 1 0 00-1 1z" />
                  </svg>
                  <span class="ml-3">Admin Col</span>
                </a>
              </li>

              <li>
                <a
                  href="/perfil-docente"
                  class="flex items-center p-2 text-base font-medium text-gray-900 rounded-lg transition duration-75 hover:bg-gray-100 dark:hover:bg-[#76B177] dark:text-white group"
                  >
                  <svg
                    aria-hidden="true"
                    class="flex-shrink-0 w-6 h-6 text-gray-500 transition duration-75 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                    >
                    <!-- <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-2 0c0 .993-.241 1.929-.668 2.754l-1.524-1.525a3.997 3.997 0 00.078-2.183l1.562-1.562C15.802 8.249 16 9.1 16 10zm-5.165 3.913l1.58 1.58A5.98 5.98 0 0110 16a5.976 5.976 0 01-2.516-.552l1.562-1.562a4.006 4.006 0 001.789.027zm-4.677-2.796a4.002 4.002 0 01-.041-2.08l-.08.08-1.53-1.533A5.98 5.98 0 004 10c0 .954.223 1.856.619 2.657l1.54-1.54zm1.088-6.45A5.974 5.974 0 0110 4c.954 0 1.856.223 2.657.619l-1.54 1.54a4.002 4.002 0 00-2.346.033L7.246 4.668zM12 10a2 2 0 11-4 0 2 2 0 014 0z" clip-rule="evenodd" ></path> -->
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87m9-7a4 4 0 11-8 0 4 4 0 018 0z" />
                  </svg>
                  <span class="ml-3">Docentes</span>
                </a>
              </li>

              <li>
                <a
                  href="/perfil-estudiante"
                  class="flex items-center p-2 text-base font-medium text-gray-900 rounded-lg transition duration-75 hover:bg-gray-100 dark:hover:bg-[#76B177] dark:text-white group"
                  >
                  <svg
                    aria-hidden="true"
                    class="flex-shrink-0 w-6 h-6 text-gray-500 transition duration-75 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                    >
                    <path
                      d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"
                    ></path>
                  </svg>
                  <span class="ml-3">Estudiantes</span>
                </a>
              </li>

              <li>
                <a
                  href="/perfil-familia"
                  class="flex items-center p-2 text-base font-medium text-gray-900 rounded-lg transition duration-75 hover:bg-gray-100 dark:hover:bg-[#76B177] dark:text-white group"
                  >
                  <svg
                    aria-hidden="true"
                    class="flex-shrink-0 w-6 h-6 text-gray-500 transition duration-75 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                    >
                    <path
                      fill-rule="evenodd"
                      d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-2 0c0 .993-.241 1.929-.668 2.754l-1.524-1.525a3.997 3.997 0 00.078-2.183l1.562-1.562C15.802 8.249 16 9.1 16 10zm-5.165 3.913l1.58 1.58A5.98 5.98 0 0110 16a5.976 5.976 0 01-2.516-.552l1.562-1.562a4.006 4.006 0 001.789.027zm-4.677-2.796a4.002 4.002 0 01-.041-2.08l-.08.08-1.53-1.533A5.98 5.98 0 004 10c0 .954.223 1.856.619 2.657l1.54-1.54zm1.088-6.45A5.974 5.974 0 0110 4c.954 0 1.856.223 2.657.619l-1.54 1.54a4.002 4.002 0 00-2.346.033L7.246 4.668zM12 10a2 2 0 11-4 0 2 2 0 014 0z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                  <span class="ml-3">Familia</span>
                </a>
              </li>

              <li>
                <a
                  href="/perfil-editor"
                  class="flex items-center p-2 text-base font-medium text-gray-900 rounded-lg transition duration-75 hover:bg-gray-100 dark:hover:bg-[#76B177] dark:text-white group"
                  >
                  <svg
                    aria-hidden="true"
                    class="flex-shrink-0 w-6 h-6 text-gray-500 transition duration-75 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                    >
                    <path
                      fill-rule="evenodd"
                      d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-2 0c0 .993-.241 1.929-.668 2.754l-1.524-1.525a3.997 3.997 0 00.078-2.183l1.562-1.562C15.802 8.249 16 9.1 16 10zm-5.165 3.913l1.58 1.58A5.98 5.98 0 0110 16a5.976 5.976 0 01-2.516-.552l1.562-1.562a4.006 4.006 0 001.789.027zm-4.677-2.796a4.002 4.002 0 01-.041-2.08l-.08.08-1.53-1.533A5.98 5.98 0 004 10c0 .954.223 1.856.619 2.657l1.54-1.54zm1.088-6.45A5.974 5.974 0 0110 4c.954 0 1.856.223 2.657.619l-1.54 1.54a4.002 4.002 0 00-2.346.033L7.246 4.668zM12 10a2 2 0 11-4 0 2 2 0 014 0z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                  <span class="ml-3">Editor Pri</span>
                </a>
              </li>

            </ul>
            <ul class="pt-2 mt-2 space-y-2 border-t border-gray-200 dark:border-gray-700"></ul>
            <ul>
              <!--Cerrar Sesion-->
              <li>
                <button
                  (click)="cerrarSesion()"
                  (keyup.enter)="cerrarSesion()"
                  type="button"
                  class="flex items-center w-full p-2 text-base font-medium text-gray-900 rounded-lg dark:text-white bg-gray-200 dark:bg-[#76B177] group cursor-pointer transition-colors hover:bg-gray-300 dark:hover:bg-[#5ca75c]"
                  title="Cerrar sesi√≥n y volver al login"
                  >
                  <svg
                    aria-hidden="true"
                    class="flex-shrink-0 w-6 h-6 text-gray-500 transition duration-75 dark:[color:#4EAD4F] group-hover:text-gray-900 dark:group-hover:text-white"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                    >
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                  </svg>
                  <span class="ml-3 whitespace-nowrap">Cerrar sesi√≥n</span>
                </button>
              </li>


            </ul>
          </div>

        </aside>

        <!-- Begin Main content -->
        <main class="p-4 md:ml-64 h-auto" style="padding-top: 4.5rem;">



          <div class="bg-[#4EAD4F] rounded-lg shadow p-8 min-h-[300px] flex flex-col items-center justify-center">
            <h2 class="text-2xl font-bold text-white mb-4">Bienvenido a Opciones</h2>
            <p class="text-white text-center mb-2">Selecciona una opci√≥n del men√∫ lateral para continuar.</p>

            <div style="border-radius: 12px; margin-bottom: 12px; width: fit-content; border: 1px solid #000; padding: 0 12px 12px 12px; display: flex; flex-direction: column; align-items: flex-start; gap: 0; background: #fff; height: 370px; box-sizing: border-box; justify-content: flex-start;">
              <label for="enunciado" style="display: block; font-weight: bold; color: #fff; margin-bottom: 2px; text-align: left; font-size: 1rem;">Enunciado</label>
              <quill-editor
                [(ngModel)]="enunciado"
                placeholder="Escribe aqu√≠..."
                [style]="'width: 600px; height: 240px; background: transparent; border: none; margin-top: 0; margin-bottom: 0; display: block; box-sizing: border-box;'"
                [modules]="{
                  toolbar: [
                    ['bold', 'italic', 'underline', 'strike'],
                    ['blockquote', 'code-block'],
                    [{ 'header': 1 }, { 'header': 2 }],
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                    [{ 'script': 'sub' }, { 'script': 'super' }],
                    [{ 'indent': '-1' }, { 'indent': '+1' }],
                    [{ 'size': ['small', false, 'large', 'huge'] }],
                    [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'font': [] }],
                    [{ 'align': [] }],
                    ['link', 'image'],
                    ['clean']
                  ]
                }"
              ></quill-editor>

            </div>

            <div style="margin-top: 12px; display: flex; gap: 12px; flex-wrap: wrap;">
              <input type="file" (change)="onFileSelected($event)" accept=".txt,.pdf,.doc,.docx" class="px-2 py-1 border rounded bg-white text-gray-700 shadow focus:outline-none focus:ring-2 focus:ring-blue-500" />
              <button class="px-4 py-2 bg-green-600 text-white rounded shadow hover:bg-green-700 transition-colors font-semibold" (click)="onNuevo()">
                <span class="inline-block align-middle mr-1">üÜï</span> Nuevo
              </button>
              <button class="px-4 py-2 bg-blue-600 text-white rounded shadow hover:bg-blue-700 transition-colors font-semibold" (click)="onSave()">
                <span class="inline-block align-middle mr-1">üíæ</span> Grabar
              </button>
              <button class="px-4 py-2 bg-purple-600 text-white rounded shadow hover:bg-purple-700 transition-colors font-semibold" (click)="onSaveAs()">
                <span class="inline-block align-middle mr-1">üìù</span> Grabar Como
              </button>
            </div>

          </div>

          <!-- Bot√≥n Activar Libro -->
          <div class="flex flex-col items-center justify-center mt-8">
            <button
              class="px-8 py-3 bg-orange-600 text-white font-bold rounded-lg shadow hover:bg-orange-700 transition-colors text-lg"
              (click)="onActivarLibro()"
              >
              Activar Libro
            </button>
          </div>

          <!-- Modal Activar Libro -->
          @if (mostrarModalActivarLibro) {
            <div class="fixed inset-0 z-50">
              <div class="bg-[#76B177] rounded-lg p-0 relative animate-fade-in border-4 border-red-600" style="width: 46.8vw; height: 60vh; min-width: 192px; min-height: 192px; position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); display: flex; flex-direction: column; box-sizing: border-box; overflow: hidden;">
                <button (click)="cerrarModalActivarLibro()" class="absolute top-2 right-2 text-white hover:text-yellow-300 text-2xl font-bold focus:outline-none">&times;</button>
                <app-activar-libros style="width: 100%; height: 100%;" (cerrar)="cerrarModalActivarLibro()"></app-activar-libros>
              </div>
            </div>
          }

        </main>
        <!-- End Main content -->

      </div>
